package com.springboot.springboot.entity.planning;

import jakarta.persistence.*;
import java.time.LocalDate;
import java.time.LocalTime;

import java.time.Duration;

@Entity
@Table(name = "creneau")
public class Creneau {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private int id;

    @Column(name = "jour_semaine", nullable = false, length = 20)
    private String jourSemaine;

    @Column(name = "heure_debut", nullable = false)
    private LocalTime heureDebut;

    @Column(name = "heure_fin", nullable = false)
    private LocalTime heureFin;

    @Column(nullable = false)
    private LocalDate date;

    private String statut;

    public Creneau() {}

    public Creneau(int id) {
        this.id = id;
    }

    // ======================
    // MÉTHODES MÉTIER
    // ======================

    @Transient
    public String getStatutActuel() {
        LocalDate today = LocalDate.now();
        LocalTime now = LocalTime.now();
        String statut;
        
        if (this.date == null) {
            statut = "Planifié";
        } else if (this.date.isBefore(today)) {
            statut = "Terminé";
        } else if (this.date.isAfter(today)) {
            statut = "À venir";
        } else { // date == today
            if (now.isBefore(this.heureDebut)) {
                statut = "À venir";
            } else if (now.isAfter(this.heureFin)) {
                statut = "Terminé";
            } else {
                statut = "En cours";
            }
        }
        
        return statut;
    }

    public boolean chevauche(Creneau autre) {
        if (autre == null) return false;
        if (!this.jourSemaine.equals(autre.jourSemaine)) return false;
        return !this.heureFin.isBefore(autre.heureDebut) && !this.heureDebut.isAfter(autre.heureFin);
    }

    public int getDuree() { 
        return (int) Duration.between(heureDebut, heureFin).toMinutes(); 
    }

    public boolean estValide() { 
        return heureFin.isAfter(heureDebut); 
    }

    // ======================
    // GETTERS / SETTERS
    // ======================

    public int getId() { return id; }
    public void setId(int id) { this.id = id; }
    public String getJourSemaine() { return jourSemaine; }
    public void setJourSemaine(String jourSemaine) { this.jourSemaine = jourSemaine; }
    public LocalTime getHeureDebut() { return heureDebut; }
    public void setHeureDebut(LocalTime heureDebut) { this.heureDebut = heureDebut; }
    public LocalTime getHeureFin() { return heureFin; }
    public void setHeureFin(LocalTime heureFin) { this.heureFin = heureFin; }
    public LocalDate getDate() { return date; }
    public void setDate(LocalDate date) { this.date = date; }
    public String getStatut() { return statut; }
    public void setStatut(String statut) { this.statut = statut; }


}
